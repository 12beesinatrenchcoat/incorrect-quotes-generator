(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))o(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const c of r.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&o(c)}).observe(document,{childList:!0,subtree:!0});function n(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerPolicy&&(r.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?r.credentials="include":s.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function o(s){if(s.ep)return;s.ep=!0;const r=n(s);fetch(s.href,r)}})();const b={};window.fetchedPromptSets={};const g={};window.filteredPrompts={};const P={};fetch("./promptSetList.json").then(e=>e.json()).then(e=>{Object.keys(e).forEach(t=>{b[t]=e[t]})}).then(()=>{Object.keys(b).forEach(e=>{A(e)}),document.querySelector("#prompt-sets-loading").hidden=!0});const R=document.querySelector("#prompt-set-selector");function A(e){const t=b[e],n=document.createElement("input");n.type="checkbox",n.id=e,n.className="prompt-set",n.addEventListener("input",async r=>{const{target:c}=r,i=c.id;c.checked?(c.indeterminate=!0,await window.fetchPromptSet(b[i].path,i),c.indeterminate=!1,Object.keys(window.fetchedPromptSets[i].prompts).forEach(a=>{g[a]||(g[a]=[]),g[a]=[...g[a],...window.fetchedPromptSets[i].prompts[a]]})):Object.keys(g).forEach(a=>{g[a]=g[a].filter(h=>h.set!==i)}),M()});const o=document.createElement("label");o.appendChild(n);const s=document.createElement("strong");if(s.textContent=t.title,o.appendChild(s),o.append(" "+t.description+" "),t.url){const r=document.createElement("a");r.textContent="Source",r.href=t.url,o.append(r)}R.appendChild(o)}const F=(e,t)=>{e.set=t,e.tags&&e.tags.forEach(n=>{P[n]||(P[n]={enabled:!0},B(n))})},$=document.querySelector("#prompt-count"),T=document.querySelector("#generate-quote");function O(){let e=0;V(window.filteredPrompts,()=>{e++}),$.textContent=`${e>0?e:"no"} prompt${e===1?"":"s"}`,e===0?T.disabled=!0:T.disabled=!1}function V(e,t){return Object.keys(e).forEach(n=>{e[n].forEach(o=>t(o))}),e}window.fetchPromptSet=async(e,t)=>{window.fetchedPromptSets[t]?console.debug(`${b[t].title} already fetched...`):await fetch(e).then(n=>n.json()).then(n=>{b[t]||(b[t]={title:n.title,description:n.description,url:n.url,path:e}),Object.keys(n.prompts).forEach(o=>{n.prompts[o].forEach(s=>F(s,t))}),window.fetchedPromptSets[t]=n,console.debug(`fetched ${b[t].title}!`,n)}),document.querySelector("#"+t)||A(t)};const Q=document.querySelector("#tag-list");function B(e){Object.keys(P).length>0&&(document.querySelector("#tag-list-empty").hidden=!0);const t=document.createElement("span");t.className="tag";const n=document.createElement("input");n.type="checkbox",n.id=e,n.checked=!0,n.addEventListener("input",s=>{const{target:r}=s;P[r.id].enabled=r.checked,r.checked?M():console.debug(`filtered out ${I(r.id)} prompts with tag ${r.id}!`)}),t.appendChild(n);const o=document.createElement("label");o.htmlFor=e,o.append(e),t.appendChild(o),Q.appendChild(t)}function I(e){let t=0;return Object.keys(window.filteredPrompts).forEach(n=>{window.filteredPrompts[n]=window.filteredPrompts[n].filter(o=>o.tags&&o.tags.includes(e)?(t++,!1):!0)}),O(),t}function M(){let e=0;const t=[];window.filteredPrompts={...g},Object.keys(P).forEach(n=>{P[n].enabled||(t.push(n),e+=I(n))}),console.debug(`reset window.filteredPrompts, and filtered ${t.length>0?`${e} prompts with tags [${t.join(", ")}]`:"nothing"}!`),O()}window.generateQuote=function(){console.group("creating a new quote..."),console.time("generateQuote");const e=window.getCharacters();if(window.settings.randomize.checked)for(let l=e.length-1;l>0;l--){const w=Math.floor(Math.random()*(l+1));[e[l],e[w]]=[e[w],e[l]]}const t=window.settings["prompt-characters-min"],n=window.settings["prompt-characters-max"],o=t.value||t.placeholder,s=n.value||n.placeholder,r=window.settings["character-range-toggle"].checked?H(o,s):o;console.debug(`using ${r} characters...`);const c=window.filteredPrompts[r],i=c[Math.floor(Math.random()*c.length)];let a=i.text;console.debug("prompt:",i),console.groupCollapsed("text replacement"),console.time("generateQuote > text replacement");const h="{{",p="}}";let S=a.indexOf(h),u=a.indexOf(p);for(;S>=0;){let l;const w=a.substring(S+2,u);let[m,v]=w.split("%",2);m=m.split("?",2),m[0]=m[0].split(".");const x=e[m[0].shift()-1];let d=m[0].shift().trim();for(l=x[d];typeof l=="object";)d=m[0].shift().trim(),l=l[d];let f="";if(typeof l=="boolean"){console.debug(l);const C=m[1].split(":");l=l?C[0]:C[1],f=m[0]?C[1]:C[0],f=f.trim(),f=q(f,v)}l=l.trim(),l=q(l,v),console.debug('replacing "'+w+'" with "'+l+'"');const j=window.createField(d,x.charNum,l);f&&(j.dataset.alt=f),a=a.replace(h+w+p,j.outerHTML),S=a.indexOf(h),u=a.indexOf(p)}console.timeEnd("generateQuote > text replacement"),console.groupEnd(),document.querySelector("#output").innerHTML=a,window.fields[0]=document.querySelectorAll("#output .field");const y=document.querySelector("#output-about");y.innerText="from ";const E=document.createElement("em");E.innerText=window.fetchedPromptSets[i.set].title,y.appendChild(E),console.timeEnd("generateQuote"),console.groupEnd()};const H=function(e,t){e=Number(e),t=Number(t);const n={};let o=0;for(let a=e;a<t+1;a++){const h=window.filteredPrompts[a].length;o+=h,n[a]=h}const s=Object.keys(n);s.forEach(a=>{n[a]/=o});const r=Math.random();let c=0,i;return s.some(a=>(c+=n[a],r<=c?(i=a,!0):!1)),i},q=function(e="",t=""){return t&&(t=t.split(" "),t.forEach(n=>{switch(n){case"upper":e=e.toUpperCase();break;case"first":e=e[0];break}})),e},N=document.querySelector("#character-blocks");window.charInputs={};window.onload=()=>{window.addInput()};window.getCharacters=()=>{const e=[];return document.querySelectorAll(".character-block").forEach(t=>{const{children:n}=t,o={};for(const r of n[1].querySelector(".pronouns").querySelectorAll("input")){const c=r;o[c.name]=c.value||c.placeholder}const s=document.querySelector(".char-"+n[0].dataset.charNum+".plural").checked;e.push({name:n[0].value||n[0].placeholder,pronouns:o,plural:s,charNum:Number(n[0].dataset.charNum)})}),e};window.getCharacterInput=(e,...t)=>{const n=N.children[e-1];if(!n)return;t="."+t.join(".");const o=n.querySelector("input"+t);return o.value||o.placeholder};const D=document.createElement("style");document.head.append(D);window.addInput=function(){const e=window.getCharacters().length+1,t=document.createElement("div");t.className="character-block";const n=document.createElement("input");n.classList.add("name","char-"+e),n.dataset.charNum=e,n.name="name",n.setAttribute("placeholder","character "+e),n.setAttribute("type","text"),n.addEventListener("input",o=>window.updateFields(o)),t.appendChild(n),t.appendChild(window.createPronounsDiv(e)),D.sheet.insertRule(`.char-${e} { background: var(--accent-${e%10||10}) }`),N.append(t),window.fields[e]=t.querySelectorAll(".field"),window.charInputs[e]={name:document.querySelector("input.name.char-"+e),pronouns:document.querySelectorAll("input.pronoun.char-"+e),settings:document.querySelectorAll("input.pronoun-setting.char-"+e)},window.updateCharacterRange(e)};window.removeInput=function(){const e=document.querySelectorAll(".character-block");e.length>1?(window.fields.splice(e.length,1),e[e.length-1].remove()):console.debug("there's only one..."),window.updateCharacterRange(e.length-1)};window.pronounTypes={subjectPn:{name:"subject pronoun",defaults:{none:"they"},examples:["This morning, {{input}} went to the park."]},objectPn:{name:"object pronoun",defaults:{none:"them"},examples:["I went with {{input}}."]},possessiveDet:{name:"possessive determiner",defaults:{none:"their"},examples:["{{name}} threw {{input}} frisbee."]},possessivePn:{name:"possessive pronoun",defaults:{none:"theirs",singular:"{{possessiveDet}}s",plural:"{{possessiveDet}}s"},examples:["At least I think it was {{input}}."]},reflexivePn:{name:"reflexive pronoun",defaults:{none:"themself",singular:"{{objectPn}}self",plural:"{{objectPn}}selves"},examples:["{{name}} can do it by {{input}}."]}};const _=[{subjectPn:"he",objectPn:"him",possessiveDet:"his",possessivePn:"his",reflexivePn:"himself"},{subjectPn:"she",objectPn:"her",possessiveDet:"her",possessivePn:"hers",reflexivePn:"herself"},{subjectPn:"it",objectPn:"it",possessiveDet:"its",possessivePn:"its",reflexivePn:"itself"}];window.createPronounsDiv=function(e){const t=document.createElement("div");t.className="pronouns-block";const n=document.createElement("button");t.appendChild(n),n.textContent="pronouns",n.onclick=function(){const a=this.parentNode.lastChild;a.style.display==="none"?a.style.display="flex":a.style.display="none"};const o=document.createElement("div");o.className="columns",o.style.display="none",t.appendChild(o);const s=document.createElement("div");s.className="pronouns",Object.keys(window.pronounTypes).forEach(a=>{const h=window.pronounTypes[a],p=document.createElement("input");p.classList.add("char-"+e,"pronoun",a),p.dataset.charNum=e,p.setAttribute("placeholder",h.defaults.none),p.setAttribute("name",a),p.addEventListener("input",d=>k(d)),p.addEventListener("input",d=>window.updateFields(d)),p.addEventListener("placeholder-change",d=>window.updateFields(d));const{examples:S}=h;let u=S[Math.floor(Math.random()*S.length)];const y="{{",E="}}";let l=u.indexOf(y),w=u.indexOf(E),m="";const v=[];for(;l>=0;){const d=u.substring(l+2,w);switch(d){case"name":m=window.createField("name",e).outerHTML;break;case"input":{const f=u.split(y+d+E);v[0]=f[0],u=f[1];break}}u=u.replace(y+d+E,m),l=u.indexOf(y),w=u.indexOf(E)}v[1]=u;const x=document.createElement("label");x.insertAdjacentHTML("afterbegin",v[0]),x.insertAdjacentElement("beforeend",p),x.insertAdjacentHTML("beforeend",v[1]),s.appendChild(x)});const r=document.createElement("div");r.className="pronounSettings";const c=document.createElement("label"),i=document.createElement("input");return i.type="checkbox",i.classList.add("char-"+e,"plural","pronoun-setting"),i.dataset.charNum=e,i.name="plural",i.addEventListener("change",a=>k(a)),i.addEventListener("change",a=>window.updateFields(a)),c.appendChild(i),c.insertAdjacentText("beforeend","Treat as plural"),r.append(c),o.append(s,r),t};function k(e){const t=e.target.classList[0].slice(5),{pronouns:n,settings:o}=window.charInputs[t],s=new Map;o.forEach(r=>{s.set(r.name,r.checked)}),_.some(r=>{if(n[0].value===r.subjectPn){console.info('matched "'+n[0].value+'" for character '+t+"! setting placeholder values for remaining inputs…");for(const c of n)c.placeholder=r[c.name],c.dispatchEvent(new Event("placeholder-change"));return!0}return!1})||n.forEach(r=>{s.get("plural")?r.placeholder=window.pronounTypes[r.name].defaults.plural??window.pronounTypes[r.name].defaults.none:r.placeholder=window.pronounTypes[r.name].defaults.singular??window.pronounTypes[r.name].defaults.none;let c=r.placeholder.indexOf("{{"),i=r.placeholder.indexOf("}}");for(;c>=0;){const a=r.placeholder.substring(c+2,i);r.placeholder=r.placeholder.replace("{{"+a+"}}",window.getCharacterInput(t,a)),c=r.placeholder.indexOf("{{"),i=r.placeholder.indexOf("}}")}r.dispatchEvent(new Event("placeholder-change"))})}window.settings={};document.querySelectorAll("#settings input").forEach(e=>{window.settings[e.id]=document.getElementById(e.id)});console.debug(window.settings);document.querySelector("#prompt-characters-min").addEventListener("input",e=>{if(isNaN(e.target.valueAsNumber))return;const{target:t}=e,n=L(t.valueAsNumber,t.min,t.max);if(window.settings["character-range-toggle"].checked){const o=document.querySelector("#prompt-characters-max");o.min=n+1,o.value&&(o.value=L(o.valueAsNumber,o.min,o.max))}});document.querySelectorAll("#settings input[type=number]").forEach(e=>{e.addEventListener("input",t=>{const{target:n}=t;n.value=L(n.value,n.min,n.max),n.value==="1"?n.nextSibling.nodeValue=" character":n.nextSibling.nodeValue=" characters"})});window.updateCharacterRange=function(e){const t=document.querySelector("#prompt-characters-min"),n=document.querySelector("#prompt-characters-max");window.settings["character-range-toggle"].checked?(t.max=e-1,t.placeholder=1):(t.max=e||1,t.placeholder=e),!t.value&&t.placeholder>1?t.nextSibling.nodeValue=" characters":t.nextSibling.nodeValue=" character",n.max=e,n.placeholder=e;const s=document.querySelector("#character-range-toggle");s.disabled=e===1,e===1&&s.checked&&(s.checked=!1,n.parentElement.hidden=!0,console.debug("updated setting character-range-toggle to value false","(too few characters!)"))};document.querySelector("#character-range-toggle").addEventListener("input",e=>{const t=document.querySelectorAll("#settings input[type=number]"),n=window.getCharacters().length;e.target.checked?(t[0].previousSibling.nodeValue="Use prompts with at least ",t[1].parentElement.hidden=!1,t[0].placeholder=1,t[0].max=n-1,t[1].max=n):(t[0].previousSibling.nodeValue="Use prompts with ",t[1].parentElement.hidden=!0,t[0].placeholder=n,t[0].max=n)});const L=(e,t,n)=>Math.min(Math.max(e,t),n);window.fields=[[]];window.createField=function(e,t,n){const o=document.createElement("span");if(o.classList.add("field","char-"+t,e),o.title=e+" (character "+t+")",!n&&(n=window.getCharacterInput(t,e),!n))switch(e){case"name":n="Character";break;default:n=window.pronounTypes[e].defaults.none;break}return o.textContent=n,o};window.updateFields=e=>{const t=e.target;if(t.name==="name"&&window.fields[t.dataset.charNum].forEach(o=>{o.innerText=t.value||t.placeholder}),window.settings["update-output-fields"].checked){const n=".char-"+t.dataset.charNum+"."+t.name;document.querySelectorAll("#output .field"+n).forEach(o=>{if(t.name==="plural"){const s=o.innerText;o.innerText=o.dataset.alt,o.dataset.alt=s}else o.innerText=t.value||t.placeholder})}};
